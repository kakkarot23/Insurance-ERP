{% extends 'base.html' %}

{% block title %}Commission Module - Insurance ERP{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h2>Commission Management</h2>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body text-center">
                <h5>Total Commission</h5>
                <p class="h3">₹{{ total_commission }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body text-center">
                <h5>Paid</h5>
                <p class="h3">₹{{ paid_commission }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body text-center">
                <h5>Pending</h5>
                <p class="h3">₹{{ pending_commission }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-info">
            <div class="card-body text-center">
                <h5>Agents</h5>
                <p class="h3">{{ agents|length }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col">
                        <h5>Agents</h5>
                    </div>
                    <div class="col text-end">
                        <a href="{% url 'commissions:agent_create' %}" class="btn btn-sm btn-primary">New Agent</a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Rate</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for agent in agents %}
                            <tr>
                                <td>{{ agent.agent_code }}</td>
                                <td><a href="{% url 'commissions:agent_detail' agent.id %}">{{ agent.name }}</a></td>
                                <td>{{ agent.get_agent_type_display|truncatewords:1 }}</td>
                                <td>{{ agent.commission_rate }}%</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">No agents found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col">
                        <h5>Recent Commissions</h5>
                    </div>
                    <div class="col text-end">
                        <a href="{% url 'commissions:commission_create' %}" class="btn btn-sm btn-primary">New Commission</a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Number</th>
                                <th>Agent</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for commission in commissions|slice:":10" %}
                            <tr>
                                <td><a href="{% url 'commissions:commission_detail' commission.id %}">{{ commission.commission_number }}</a></td>
                                <td>{{ commission.agent.name }}</td>
                                <td>₹{{ commission.commission_amount }}</td>
                                <td><span class="badge bg-{% if commission.status == 'PAID' %}success{% else %}warning{% endif %}">{{ commission.status }}</span></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">No commissions found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
